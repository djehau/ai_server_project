<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTuber AI Control Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .service-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
        }
        
        .service-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
        }
        
        .status-dot.running {
            background: #28a745;
        }
        
        .chat-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
        }
        
        .message.user {
            background: #007bff;
            color: white;
            margin-left: 20%;
        }
        
        .message.ai {
            background: #e9ecef;
            margin-right: 20%;
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
        }
        
        .chat-input button {
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .chat-input button:hover {
            background: #0056b3;
        }
        
        .emoji-indicator {
            font-size: 2em;
            text-align: center;
            margin: 20px 0;
        }
        
        .metrics-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .metrics-container h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .metric-card {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .metric-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .metric-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .metric-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            transition: width 0.5s ease;
            border-radius: 4px;
        }
        
        .logs-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .logs-container h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .logs-container pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.85em;
            color: #333;
            line-height: 1.4;
            font-family: 'Consolas', 'Monaco', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin: 0;
        }
        
        .navigation {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .nav-button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ VTuber AI Control Panel</h1>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ö–∞—Ç—é—à–∏</p>
        </div>
        
        <div class="navigation">
            <div class="nav-buttons">
                <a href="/" class="nav-button">
                    üè† –ì–ª–∞–≤–Ω–∞—è
                </a>
                <a href="/memory/viewer" class="nav-button">
                    üß† –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞–º—è—Ç–∏
                </a>
                <button class="nav-button" onclick="refreshAll()">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div class="services-grid" id="servicesGrid">
            <!-- –°–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="metrics-container" id="metricsContainer">
            <h3>üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üñ•Ô∏è</div>
                    <div class="metric-label">CPU</div>
                    <div class="metric-value" id="cpuMetric">--%</div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="cpuBar"></div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">üíæ</div>
                    <div class="metric-label">–ü–∞–º—è—Ç—å</div>
                    <div class="metric-value" id="memoryMetric">--%</div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="memoryBar"></div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">üíø</div>
                    <div class="metric-label">–î–∏—Å–∫</div>
                    <div class="metric-value" id="diskMetric">--%</div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="diskBar"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="logs-container" id="logsContainer">
            <h3>üìù –õ–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞</h3>
            <pre id="logsContent">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</pre>
        </div>
        
        <div class="chat-container">
            <h3>üí¨ –ß–∞—Ç —Å AI</h3>
            <div class="emoji-indicator" id="emotionDisplay">üòê</div>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ—è VTuber AI. –ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å!
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        // WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        const socket = io();
        
        const emotionEmojis = {
            'neutral': 'üòê',
            'happy': 'üòä',
            'sad': 'üò¢',
            'angry': 'üò†',
            'surprised': 'üò≤',
            'confused': 'ü§î',
            'excited': 'ü§©',
            'sleepy': 'üò¥',
            'thinking': 'ü§î'
        };
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
        function loadServicesStatus() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    const grid = document.getElementById('servicesGrid');
                    grid.innerHTML = '';
                    
                    Object.entries(data).forEach(([name, info]) => {
                        const card = document.createElement('div');
                        card.className = 'service-card';
                        card.innerHTML = `
                            <div class="service-status">
                                <div class="status-dot ${info.running ? 'running' : ''}"></div>
                                <strong>${name}</strong>
                            </div>
                            <p>${info.description}</p>
                            <small>URL: ${info.url || 'N/A'}</small>
                        `;
                        grid.appendChild(card);
                    });
                })
                .catch(error => console.error('Error loading services:', error));
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º—ã
        function loadSystemMetrics() {
            fetch('/metrics')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Metrics error:', data.error);
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º CPU
                    if (data.cpu_percent !== undefined) {
                        updateMetric('cpu', data.cpu_percent);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–º—è—Ç—å
                    if (data.memory_percent !== undefined) {
                        updateMetric('memory', data.memory_percent);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å–∫
                    if (data.disk_percent !== undefined) {
                        updateMetric('disk', data.disk_percent);
                    }
                })
                .catch(error => console.error('Error loading metrics:', error));
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏
        function updateMetric(type, percent) {
            const valueElement = document.getElementById(type + 'Metric');
            const barElement = document.getElementById(type + 'Bar');
            
            if (valueElement && barElement) {
                valueElement.textContent = Math.round(percent) + '%';
                barElement.style.width = Math.min(percent, 100) + '%';
                
                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (percent < 50) {
                    barElement.style.background = '#28a745'; // –ó–µ–ª–µ–Ω—ã–π
                } else if (percent < 80) {
                    barElement.style.background = '#ffc107'; // –ñ–µ–ª—Ç—ã–π
                } else {
                    barElement.style.background = '#dc3545'; // –ö—Ä–∞—Å–Ω—ã–π
                }
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞
        function loadProcessLogs() {
            fetch('/logs')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Logs error:', data.error);
                        document.getElementById('logsContent').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤: ' + data.error;
                        return;
                    }
                    
                    const logsContent = document.getElementById('logsContent');
                    logsContent.textContent = data.logs.join('');
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –∫ –Ω–æ–≤—ã–º –ª–æ–≥–∞–º
                    const logsContainer = document.getElementById('logsContainer');
                    logsContainer.scrollTop = logsContainer.scrollHeight;
                })
                .catch(error => {
                    console.error('Error loading logs:', error);
                    document.getElementById('logsContent').textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
                });
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            addMessage(message, 'user');
            input.value = '';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    addMessage(data.response, 'ai');
                    updateEmotion(data.emotion || 'neutral');
                } else if (data.error) {
                    addMessage('–û—à–∏–±–∫–∞: ' + data.error, 'ai');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                addMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'ai');
            });
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessage(text, type) {
            const messages = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏
        function updateEmotion(emotion) {
            const display = document.getElementById('emotionDisplay');
            display.textContent = emotionEmojis[emotion] || 'üòê';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function refreshAll() {
            loadServicesStatus();
            loadSystemMetrics();
            loadProcessLogs();
            console.log('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
        }
        
        // WebSocket —Å–æ–±—ã—Ç–∏—è
        socket.on('connect', function() {
            console.log('Connected to server');
            loadServicesStatus();
        });
        
        socket.on('status', function(data) {
            console.log('Services status update:', data);
        });
        
        socket.on('chat_response', function(data) {
            addMessage(data.response, 'ai');
            updateEmotion(data.emotion || 'neutral');
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', function() {
            loadServicesStatus();
            loadSystemMetrics();
            loadProcessLogs();
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(loadServicesStatus, 10000);
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            setInterval(loadSystemMetrics, 5000);
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(loadProcessLogs, 10000);
        });
    </script>
</body>
</html>
